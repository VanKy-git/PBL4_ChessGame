<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="../css/Home_page.css">
    <link rel="stylesheet" href="../css/Chess_board.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>
    <link rel="icon" href="../../PBL4_imgs/icon/logo.png">
    <title>Trang chủ</title>
</head>
<body>
    <div class="layout">
        <aside class="left">
            <div class="brand">
                <img src="../../PBL4_imgs/icon/logo.png" alt="Logo Mới" class="logo-image">                <div>
                <div>
                    <h1 class="ml1">
                        <span class="letter">C</span>
                        <span class="letter">H</span>
                        <span class="letter">E</span>
                        <span class="letter">S</span>
                        <span class="letter">S</span>
                        <span class="letter">W</span>
                        <span class="letter">O</span>
                        <span class="letter">R</span>
                        <span class="letter">L</span>
                        <span class="letter">D</span>
                    </h1>
                </div>
                </div>
            </div>
            <nav class="menu">
                <a href="#" id="historyLink"><i class="fa-solid fa-clock-rotate-left"></i> Lịch sử</a>
                
                <a href="#" id="account-link"><i class="fa-solid fa-user"></i> Tài khoản</a>
                
                <a href="#" id="friendsLink"><i class="fa-solid fa-user-group"></i> Bạn bè</a>
                
                <a href="#" id="leaderboardLink"><i class="fa-solid fa-ranking-star"></i> Bảng xếp hạng</a>
                
                <a href="#" id="settingsLink"><i class="fa-solid fa-gear"></i> Cài đặt</a>
            </nav>
        </aside>


        <main>
            <div class="center">
                <div class="player-bar top-player hidden" id="player1Bar">
                    <div class="player-info-left">
                        <div class="player-avatar"></div>
                        <div class="player-details">
                            <span class="player-name">Đối thủ</span>
                            <span class="player-elo">Elo: 1200</span>
                        </div>
                    </div>
                    <div class="player-info-right">
                        <div class="captured-pieces opponent-captured"></div>
                        <div class="player-time">10:00</div>
                    </div>
                </div>

                <div class="board-wrap">
                    <div class="board" id="chessBoard"></div>
                </div>

                <div class="player-bar bottom-player hidden" id="player2Bar">
                    <div class="player-info-left">
                        <div class="player-avatar"></div>
                        <div class="player-details">
                            <span class="player-name">Bạn</span>
                            <span class="player-elo">Elo: 1200</span>
                        </div>
                    </div>
                    <div class="player-info-right">
                        <div class="captured-pieces self-captured"></div>
                        <div class="player-time">10:00</div>
                    </div>
                </div>
            </div>
        </main>
        <aside class="right-panel">
            <div style="font-weight:500">Chế độ chơi</div>
            <div class="modes">
                <div class="mode" data-mode="ai">
                    <div><i class="fa-solid fa-robot"></i></div>
                    <div>
                        <div style="font-weight:700">Chơi với AI</div>
                        <div class="muted">Nhiều mức độ</div>
                    </div>
                </div>
                <div class="mode" data-mode="online">
                    <div><i class="fa-solid fa-earth-americas"></i></div>
                    <div>
                        <div style="font-weight:700">Chơi trực tuyến</div>
                        <div class="muted">Kết nối đối thủ</div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <div id="toast-container"></div>

    <div id="draw-offer-popup" class="draw-popup hidden">
        <p><strong>Đối thủ muốn cầu hòa!</strong></p>
        <div>
            <button id="acceptDrawBtn" class="draw-btn accept">Đồng ý</button>
            <button id="declineDrawBtn" class="draw-btn decline">Từ chối</button>
        </div>
        <p class="draw-timer-text">
            <small>Tự động từ chối sau <span id="draw-countdown">15</span> giây</small>
        </p>
    </div>

    <div id="game-over-overlay" class="popup-overlay hidden">
        <div class="popup-content game-over-popup">
            <h2 id="gameOverTitle">Trận đấu kết thúc</h2>
            <p id="gameOverReason"></p>
            <div class="game-over-buttons">
                <button id="gameOverFindNewBtn" class="btn-action">Tìm trận mới</button>
                <button id="gameOverRematchBtn" class="btn-action">Tái đấu</button>
                <button id="gameOverLeaveBtn" class="btn-action btn-danger">Thoát</button>
            </div>
        </div>
    </div>

    <div id="confirmation-overlay" class="popup-overlay hidden">
        <div class="popup-content confirmation-popup">
            <h3 id="confirmTitle">Xác nhận hành động</h3>
            <p id="confirmMessage">Bạn có chắc chắn muốn thực hiện?</p>
            <div class="confirmation-buttons">
                <button id="confirmBtnYes" class="btn-action confirm">Đồng ý</button>
                <button id="confirmBtnNo" class="btn-action cancel">Hủy bỏ</button>
            </div>
        </div>
    </div>

    <div id="historyPopup" class="popup-overlay" style="display:none;">
        <div class="popup-content" style="max-height:80vh;overflow-y:auto;">
            <h2>Lịch sử trận đấu</h2>
            <div id="historyContainer">Đang tải...</div>
            <button id="historyClose" class="close-btn">Đóng</button>
        </div>
    </div>

    <div id="friendsPopup" class="popup-overlay" style="display:none;">
        <div class="popup-content friends-popup-content" style="max-height:80vh;overflow-y:auto;">
            <h2>Bạn bè</h2>
            <div class="friends-tabs">
                <button class="tab-btn active" data-tab="list">Danh sách</button>
                <button class="tab-btn" data-tab="search">Tìm kiếm</button>
                <button class="tab-btn" data-tab="requests">Lời mời</button>
            </div>
            <div id="friendsTabContent" class="tab-content">
                <!-- Nội dung sẽ được render bởi JS -->
            </div>
            <button id="friendsClose" class="close-btn">Đóng</button>
        </div>
    </div>

    <div id="leaderboardPopup" class="popup-overlay" style="display:none;">
        <div class="popup-content leaderboard-popup-content" style="max-height:80vh;overflow-y:auto;">
            <h2>Bảng xếp hạng</h2>
            <div id="leaderboardContainer">Đang tải...</div>
            <button id="leaderboardClose" class="close-btn">Đóng</button>
        </div>
    </div>

    <div id="accountPopup" class="popup-overlay" style="display:none;">
        <div class="popup-content account-popup-content">
            <h2>Thông tin tài khoản</h2>
            <div id="accountContainer">Đang tải...</div>
            <button id="accountClose" class="close-btn">Đóng</button>
        </div>
    </div>

    <div id="changePasswordPopup" class="popup-overlay" style="display:none;">
        <div class="popup-content">
            <h2>Đổi mật khẩu</h2>
            <div class="form-group">
                <input type="password" id="oldPassword" class="input" placeholder="Mật khẩu cũ">
            </div>
            <div class="form-group">
                <input type="password" id="newPassword" class="input" placeholder="Mật khẩu mới">
            </div>
            <div class="form-group">
                <input type="password" id="confirmNewPassword" class="input" placeholder="Xác nhận mật khẩu mới">
            </div>
            <div class="confirmation-buttons" style="margin-top: 20px;">
                <button id="submitChangePasswordBtn" class="btn-action confirm">Xác nhận</button>
                <button id="cancelChangePasswordBtn" class="btn-action cancel">Hủy</button>
            </div>
        </div>
    </div>

    <div id="settingsPopup" class="popup-overlay" style="display:none;">
        <div class="popup-content settings-popup-content">
            <h2>Cài đặt giao diện</h2>

            <div class="settings-section">
                <h3>Chủ đề bàn cờ</h3>
                <div class="board-theme-options">
                    <div class="theme-option" data-theme="default" title="Mặc định">
                        <div class="theme-preview" style="background: linear-gradient(45deg, #f0d9b5 25%, #b58863 25%, #b58863 50%, #f0d9b5 50%, #f0d9b5 75%, #b58863 75%, #b58863 100%); background-size: 20px 20px;"></div>
                        <span>Mặc định</span>
                    </div>
                    <div class="theme-option" data-theme="green" title="Xanh lá">
                        <div class="theme-preview" style="background: linear-gradient(45deg, #eeeed2 25%, #769656 25%, #769656 50%, #eeeed2 50%, #eeeed2 75%, #769656 75%, #769656 100%); background-size: 20px 20px;"></div>
                        <span>Xanh lá</span>
                    </div>
                    <div class="theme-option" data-theme="blue" title="Xanh dương">
                        <div class="theme-preview" style="background: linear-gradient(45deg, #dee3e6 25%, #8ca2ad 25%, #8ca2ad 50%, #dee3e6 50%, #dee3e6 75%, #8ca2ad 75%, #8ca2ad 100%); background-size: 20px 20px;"></div>
                        <span>Xanh dương</span>
                    </div>
                    <div class="theme-option" data-theme="wood" title="Gỗ">
                        <div class="theme-preview" style="background: linear-gradient(45deg, #e8cba0 25%, #a67c52 25%, #a67c52 50%, #e8cba0 50%, #e8cba0 75%, #a67c52 75%, #a67c52 100%); background-size: 20px 20px;"></div>
                        <span>Gỗ</span>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3>Tùy chỉnh màu (Nâng cao)</h3>
                <div class="color-picker-group">
                    <div class="color-picker-item">
                        <label for="lightSquareColor">Ô sáng</label>
                        <input type="color" id="lightSquareColor">
                    </div>
                    <div class="color-picker-item">
                        <label for="darkSquareColor">Ô tối</label>
                        <input type="color" id="darkSquareColor">
                    </div>
                </div>
            </div>

            <div class="confirmation-buttons" style="margin-top: 20px;">
                <button id="saveSettingsBtn" class="btn-action confirm">Lưu & Đóng</button>
                <button id="cancelSettingsBtn" class="btn-action cancel">Hủy</button>
            </div>
        </div>
    </div>

    <div id="matchmaking-overlay" class="popup-overlay hidden">
        <div class="popup-content matchmaking-popup">
            <h2>Đang tìm đối thủ...</h2>
            <div class="spinner"></div>
            <p><span id="matchmaking-timer">00:00</span></p>
            <p>Trận đấu sắp diễn ra...</p>
            <button id="cancelMatchmakingBtn" class="btn-action btn-danger">Hủy</button>
        </div>
    </div>

    <div id="time-control-overlay" class="popup-overlay hidden">
        <div class="popup-content time-control-popup">
            <h3>Chọn Thời gian Ván đấu</h3>
            <div class="time-options">
                <button class="time-btn" data-time="300000">5 Minutes</button> <button class="time-btn" data-time="600000">10 Minutes</button> <button class="time-btn" data-time="900000">15 Minutes</button> </div>
            <button id="cancelTimeSelectionBtn" class="btn-action cancel">Hủy</button>
        </div>
    </div>

    <script type = "module" src="../js/Chess_board.js"></script>
    <script type="module" src="../js/game_controller.js"></script>
    <script type = "module" src="../js/Home_page.js"></script>
    <script src="../js/Account_setting.js"></script>
    <script type="module" src="../js/Settings.js"></script>
    <script type="module" src="../js/History.js"></script>
    <script type="module" src="../js/Friend_list.js"></script>
    <script type="module" src="../js/Leader_board.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

    <div id="ai-setup-overlay" class="popup-overlay hidden">
        <div class="popup-content ai-popup">
            <h3>Cấu hình AI Stockfish</h3>

            <div class="setup-section">
                <label>Độ khó (Elo):</label>
                <div class="elo-options">
                    <button class="elo-btn selected" data-elo="1350">Dễ (1350)</button>
                    <button class="elo-btn" data-elo="1600">Vừa (1600)</button>
                    <button class="elo-btn" data-elo="2000">Khó (2000)</button>
                    <button class="elo-btn" data-elo="2500">Kiện tướng</button>
                </div>
            </div>

            <div class="setup-section">
                <label>Thời gian:</label>
                <div class="time-options-ai">
                    <button class="time-btn-ai selected" data-time="600000">10 Phút</button>
                    <button class="time-btn-ai" data-time="900000">15 Phút</button>
                    <button class="time-btn-ai" data-time="1800000">30 Phút</button>
                </div>
            </div>

            <div class="setup-section">
                <label>Chọn màu:</label>
                <div class="color-options">
                    <button class="color-btn selected" data-color="random"><i class="fa-solid fa-shuffle"></i> Ngẫu nhiên</button>
                    <button class="color-btn" data-color="white"><span class="white-piece-icon"></span> Trắng</button>
                    <button class="color-btn" data-color="black"><span class="black-piece-icon"></span> Đen</button>
                </div>
            </div>

            <div class="confirmation-buttons">
                <button id="startAiGameBtn" class="btn-action confirm">Bắt đầu</button>
                <button id="cancelAiSetupBtn" class="btn-action cancel">Hủy</button>
            </div>
        </div>
    </div>

    <div id="promotion-overlay" class="popup-overlay hidden">
        <div class="popup-content promotion-popup">
            <h3>Chọn quân phong cấp</h3>
            <div class="promotion-options">
                <div class="promo-option" data-piece="q"><img src="" alt="Queen"></div>
                <div class="promo-option" data-piece="r"><img src="" alt="Rook"></div>
                <div class="promo-option" data-piece="b"><img src="" alt="Bishop"></div>
                <div class="promo-option" data-piece="n"><img src="" alt="Knight"></div>
            </div>
            <button id="cancelPromotionBtn" class="btn-action cancel">Hủy</button>
        </div>
    </div>

    <div id="invite-popup" class="popup-overlay hidden">
        <div class="popup-content invite-popup">
            <h3>Mời <span id="invite-friend-name"></span> đấu</h3>
            <div class="time-options">
                <button class="time-btn" data-time="300000">5 Phút</button>
                <button class="time-btn" data-time="600000">10 Phút</button>
                <button class="time-btn" data-time="900000">15 Phút</button>
            </div>
            <button id="cancelInviteBtn" class="btn-action cancel">Hủy</button>
        </div>
    </div>

    <div id="game-invite-popup" class="popup-overlay hidden">
        <div class="popup-content invite-popup">
            <h3>Lời mời thách đấu</h3>
            <p><strong id="inviter-name">User</strong> muốn thách đấu với bạn!</p>
            <div class="confirmation-buttons">
                <button id="acceptInviteBtn" class="btn-action confirm">Chấp nhận</button>
                <button id="declineInviteBtn" class="btn-action cancel">Từ chối</button>
            </div>
        </div>
    </div>
</body>
</html>